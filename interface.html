<!DOCTYPE html>
<html>

<head>
	<title>Aculab Cloud WebRTC - AculabCloudClient interface</title>
	<link rel="icon" type="image/gif" href="images/favicon.gif" />
</head>

<body>
	<h1>AculabCloudClient javascript interface</h1>
	<h2>Constructor</h2>
	<h3>AculabCloudClient(cloudId, webRtcAccessKey, clientId, logLevel)</h3>
	Creates an AculabCloudClient object. A page can have more than one AculabCloudClient at a time.
	<br>cloudId is the identifier of the Aculab Cloud where services that interact with the user are located.
	<br>webRtcAccessKey is the WebRTC access key of your Aculab Cloud account.
	<br>clientId identifies this client object. It is the value that will be placed in the call_from field in the call
	details of the application's main channel when making calls to inbound services. It is also the value used when
	services make outbound calls to WebRTC clients.
	<br><em>clientId can only contain alphanumeric and +-._ characters.</em>
	<br>logLevel is a numeric value between 0 and 6 inclusive. 0 disables logging and 6 is the most detailed logging.
	<h2>AculabCloudClient object functions</h2>
	<h3>static boolean isSupported()</h3>
	Returns true if the browser supports the necessary functionality and false if not.
	<h3>static array getCodecList(mediaType)</h3>
	mediaType is either "audio" or "video".
	<br>Returns an array of RTCRtpCodecCapability objects, if the browser supports the necessary functionality and 
	an empty array if not. The list can be reordered to set a preferred codec and passed in an AculabCloudCallOptions 
	object when placing or answering calls. (Note: removing items from the list is allowed but may cause inter-operability
	problems.)
	<h3>AculabCloudOutgoingCall callService(serviceName)</h3>
	serviceName is the name of the Aculab Cloud incoming service that the call will be connected to.
	<p>This initiates a call to the specified Aculab Cloud incoming service. Call progress is reported by callbacks,
		these should be set on the object returned by this function.
	<p>This throws a string exception if:
	<ul>
		<li>the browser doesn't support calling the cloud
		<li>there are too many calls already in progress
		<li>serviceName contains disallowed characters
	</ul>
	<h3>AculabCloudOutgoingCall makeOutgoing(serviceName)</h3>
	<p><i>Deprecated</i> This is an alias for <code>callService</code>, which should be used instead.
	<h3>AculabCloudOutgoingCall callClient(clientId, token, options)</h3>
	clientId is the client identifier of the WebRTC client that the call will be connected to.
	<br>token is an authenication token. These can be obtained using an Aculab Cloud webservice.
	<br>options, when specified, is a AculabCloudCallOptions object.
	<p>This initiates a call to the specified Aculab Cloud WebRTC client. Call progress is reported by callbacks,
		these should be set on the object returned by this function.
	<p>This throws a string exception if:
	<ul>
		<li>the browser doesn't support calling the cloud
		<li>there are too many calls already in progress
		<li>clientId contains disallowed characters
		<li>token is format is invalid
	</ul>
	<h3>void enableIncoming(token)</h3>
	token is an authenication token. These can be obtained using an Aculab Cloud webservice. The token can be updated by
	calling this function with the new token.
	<br>This function initiates registration of this client object as the destination for calls to the specified user.
	The status of the registration is reported by the onIncomingState callback.
	<p>This throws a string exception if the token format is invalid.
	<h3>void disableIncoming()</h3>
	This function initiates the removal of this client as the destination for call to the specified user. The status of
	the registration is reported by the onIncomingState callback.

	<h2>AculabCloudClient data properties</h2>
	<h3>iceServers</h3>
	Must be null or an array of RTCIceServer objects. This value can be changed at any time. Outgoing calls will use the
	value set when the call is made. Incoming calls will use the value set when the call is answered. If the value is
	null, an Aculab provided set of iceServers is used. Using an empty array will disable the Aculab provided
	iceServers.
	<h3>maxConcurrent</h3>
	This is the number of concurrent calls this client is allowed to handle. The default is 1. This value must be 1 or
	greater. The upper limit is browser dependent.
	<h2>AculabCloudClient callback properties</h2>
	Each of these callback properties must be either <code>null</code> or a function. The function will be passed a
	single object
	parameter. Additional information may be included as properties of that object. All such properties are detailed
	below.
	<h3>onIncomingState</h3>
	<p>Called when user registration state changes.</p>
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>ready</code></td>
			<td>A boolean indicating whether this client is waiting for incoming calls.</td>
		</tr>
		<tr>
			<td><code>cause</code></td>
			<td>One of the following strings:
				<dl>
					<dt>'DISCONNECTED'</dt>
					<dd>the connection to the cloud has been lost.</dd>
					<dt>'INVALIDTOKEN'</dt>
					<dd>the token specified is not valid (for example, it has expired)</dd>
					<dt>'FAILED'</dt>
					<dd>the registration was unsuccessful for some other reason</dd>
					<dt>'NORMAL'</dt>
					<dd>the state change was in response to API calls</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td><code>retry</code></td>
			<td>A boolean indicating whether the client will automatically retry the registration.</td>
		</tr>
	</table>
	<h3>onIncoming</h3>
	<p>Called when an incoming call occurs. If this is null or throws an exception, the incoming call is rejected.</p>
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>An AculabCloudIncomingCall object.</td>
		</tr>
		<tr>
			<td><code>from</code></td>
			<td>The CallerID passed by the remote party.</td>
		</tr>
		<tr>
			<td><code>type</code></td>
			<td>The type of the remote party. One of "client", "service" or "other".</td>
		</tr>
		<tr>
			<td><code>offeringAudio</code></td>
			<td>The remote party is offering to send audio.</td>
		</tr>
		<tr>
			<td><code>canReceiveAudio</code></td>
			<td>The remote party can receive audio.</td>
		</tr>
		<tr>
			<td><code>offeringVideo</code></td>
			<td>The remote party is offering to send video.</td>
		</tr>
		<tr>
			<td><code>canReceiveVideo</code></td>
			<td>The remote party can receive video.</td>
		</tr>
	</table>
	<p>Call progress is reported by callbacks, these should be set on the passed call object before returning from the
		callback function.

	<h1>AculabCloudCallOptions</h1>
	This object is used to modify the default behaviour of the client when making or answering calls.
	<h2>AculabCloudCallOptions object properties</h2>
	<h3>constraints</h3>
	A MediaStreamConstraints object. The default is "{ audio: true, video: false }".
	<h3>receiveAudio</h3>
	Can be true, false or undefined. When undefined the client will receive audio if the constraints require an audio 
	track and refuse to receive audio otherwise. The default is undefined.
	<h3>receiveVideo</h3>
	Can be true, false or undefined. When undefined the client will receive video if the constraints require an video 
	track and refuse to receive video otherwise. The default is undefined.
	<h3>codecs</h3>
	An object with the following properties:
	<table border="1">
	<tr><td>audio</td>
	<td>An array of RTCRtpCodecCapability, such as that returned by AculabCloudClient.getCodecList("audio"). The default is 
	an empty array, which results in using the browser defaults.</td></tr>
	<tr><td>video</td>
	<td>An array of RTCRtpCodecCapability, such as that returned by AculabCloudClient.getCodecList("video"). The default is 
	an empty array, which results in using the browser defaults.</td></tr>
	</table>
	<h3>maxBitrateAudio</h3>
	The maximum bitrate to use for audio. Set to Infinte to have no limit, undefined to use the browser default, or 
	an integer which is in bits per second.
	<h3>maxBitrateVideo</h3>
	The maximum bitrate to use for video. Set to Infinte to have no limit, undefined to use the browser default, or 
	an integer which is in bits per second.

	<h1>AculabCloudCall</h1>
	The base class for call objects. Instances derived from this object are returned by callService(), callClient() 
	or passed to the onIncoming callback.
	<h2>AculabCloudCall object functions</h2>
	<h3>string callId()</h3>
	Gets the callId used for the call. For outgoing calls this may return <code>undefined</code> until the
	onConnecting() callback is being called. For incoming calls it is always available.
	<h3>void mute(mic, outputAudio, camera, outputVideo)</h3>
	mic, outputAudio camera and outputVideo are boolean. If mic is true, then the microphone (sent audio) is muted.
	If outputAudio is true the received audio is muted. If camera is true, then the video stream being sent has
	every frame filled entirely with black pixels. If outputVideo is true, then the video stream being received has
	every frame filled entirely with black pixels. If camera or outputVideo are undefined, then the value is replaced
	by mic and outputAudio respectively.
	<h3>void sendDtmf(dtmf_str)</h3>
	dtmf_str is a string containing the DTMF digits to be sent. These are 0,1,2,3,4,5,6,7,8,9,*,#,A,B,C and D.
	<p>This throws a string exception if there is an invalid digit in the string. There is no return value.
	<h3>void disconnect()</h3>
	Disconnects any existing call. This can be called at any time.
	<h2>AculabCloudClient callback properties</h2>
	Each of these callback properties must be either <code>null</code> or a function. The function will be passed a
	single object
	parameter. Additional information may be included as properties of that object. All such properties are detailed
	below.
	<h3>onDisconnect</h3>
	<p>The call has disconnected.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>cause</code></td>
			<td>One of the following strings:
				<dl>
					<dt>'MIC_ERROR'</dt>
					<dd>no microphone is available to the AculabCloudClient, usually because the user refused access or
						there is no microphone.</dd>
					<dt>'BUSY'</dt>
					<dd>the service called hangup() with the busy cause or the service could not be started (due to
						limited UAS capacity, for example)</dd>
					<dt>'UNOBTAINABLE'</dt>
					<dd>the specified incoming service name does not exist</dd>
					<dt>'MOVED'</dt>
					<dd>the service attempted to redirect the call</dd>
					<dt>'REJECTED'</dt>
					<dd>the call was rejected either by the incoming service or an intermediary</dd>
					<dt>'NOANSWER'</dt>
					<dd>the call did not connect</dd>
					<dt>'FAILED'</dt>
					<dd>the call was unsuccessful for some other reason</dd>
					<dt>'ERROR'</dt>
					<dd>an internal error occurred.</dd>
					<dt>'NORMAL'</dt>
					<dd>the call has disconnected in the normal way after having connected</dd>
				</dl>
			</td>
		</tr>
	</table>
	<h3>onMedia</h3>
	<p>Called when remote media is available to be rendered to the user.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object suitable connecting to an <code>&lt;audio&gt;</code> or a <code>&lt;video&gt;</code> HTMLMediaElement as the
				<code>srcObject</code>.
			</td>
		</tr>
	</table>
	<h3>onConnecting</h3>
	<p>Called once the local media has been obtained and the browser will now start to prepare the sockets
		needed to transport the call media. The passed stream is the local media.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object suitable connecting to an <code>&lt;audio&gt;</code> or a <code>&lt;video&gt;</code> HTMLMediaElement as the
				<code>srcObject</code>.
			</td>
		</tr>
	</table>
	<h3>onConnected</h3>
	<p>Called when the call has been answered.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
	</table>
	<h3>onLocalVideoMute</h3>
	<p>Called when the call's local video track has been muted.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object that is the local media stream.</td>
		</tr>
		<tr>
			<td><code>track</code></td>
			<td>A MediaStreamTrack object that is the muted local media track.</td>
		</tr>
	</table>
	<h3>onLocalVideoUnmute</h3>
	<p>Called when the call's local video track has been unmuted.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object that is the local media stream.</td>
		</tr>
		<tr>
			<td><code>track</code></td>
			<td>A MediaStreamTrack object that is the unmuted local media track.</td>
		</tr>
	</table>
	<h3>onRemoteVideoMute</h3>
	<p>Called when the call's remote video track has been muted.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object that is the remote media stream.</td>
		</tr>
		<tr>
			<td><code>track</code></td>
			<td>A MediaStreamTrack object that is the muted remote media track.</td>
		</tr>
	</table>
	<h3>onRemoteVideoUnmute</h3>
	<p>Called when the call's remote video track has been unmuted.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
		<tr>
			<td><code>stream</code></td>
			<td>A MediaStream object that is the remote media stream.</td>
		</tr>
		<tr>
			<td><code>track</code></td>
			<td>A MediaStreamTrack object that is the unmuted remote media track.</td>
		</tr>
	</table>
	<h1>AculabCloudOutgoingCall extends AculabCloudCall</h1>
	The class for outgoing call objects as returned by callService() and callClient(). No additional functions are defined.
	<h2>AculabCloudOutgoingCall callback properties</h2>
	Each of these callback properties must be either <code>null</code> or a function. The function will be passed a
	single object
	parameter. Additional information may be included as properties of that object. All such properties are detailed
	below.
	<h3>onRinging</h3>
	<p>The incoming service has signalled that the call is ringing.
	<p>The parameter object will have the following properties:</p>
	<table border="1">
		<tr>
			<th>property</th>
			<th>value</th>
		</tr>
		<tr>
			<td><code>call</code></td>
			<td>The call object that is reporting the event.</td>
		</tr>
	</table>
	<h1>AculabCloudIncomingCall extends AculabCloudCall</h1>
	The class for incoming call objects passed to the onIncoming callback. No additional callbacks are defined.
	<h2>AculabCloudIncomingCall object functions</h2>
	<h3>void answer(options)</h3>
	options, when specified, is a AculabCloudCallOptions object.
	<p>Answer the incoming call.
	<h3>void ringing()</h3>
	Notify the calling service that the user is being alerted to the incoming call.
	<h3>void reject(cause)</h3>
	Reject the incoming call with the cause value specified. The value should be a SIP response code between 400 and 699
	inclusive. If no cause is given or the specified cause is invalid, the cause 486 (Busy Here) will be used.
</body>

</html>